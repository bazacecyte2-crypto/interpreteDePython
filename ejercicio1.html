<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ejercicio 1 - Variables</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 18px; max-width: 900px; }
    textarea { width:100%; height:140px; font-family: monospace; padding:8px; box-sizing:border-box; }
    button { padding:8px 12px; margin-top:8px; }
    #output { background:#111; color:#dcdcdc; padding:10px; min-height:80px; white-space: pre-wrap; margin-top:10px; }
    #status { margin-top:8px; color:#444; }
  </style>
</head>
<body>
  <h1>Reto: Calcula tu edad en 10 años</h1>
  <p>Modifica la variable <code>edad</code> y presiona <strong>Probar</strong>.</p>

  <label for="python-code">Código:</label>
  <textarea id="python-code">edad = 25
print("Tu edad en 10 años será:", edad + 10)</textarea>

  <div>
    <button id="run" disabled>Probar mi respuesta</button>
    <button id="clear">Limpiar salida</button>
    <span id="status">Cargando entorno Python...</span>
  </div>

  <h3>Salida</h3>
  <pre id="output"></pre>

  <!-- Cargar Pyodide (CDN). Si usas la misma URL que index.html es suficiente -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

  <script>
  (async () => {
    const statusEl = document.getElementById('status');
    const runBtn = document.getElementById('run');
    const outEl = document.getElementById('output');

    // Inicializa pyodide y ponlo en window.pyodide (misma variable que en index.html)
    try {
      window.pyodide = await loadPyodide();
      statusEl.textContent = 'Pyodide cargado. Listo.';
      runBtn.disabled = false;
    } catch (err) {
      statusEl.textContent = 'Error cargando Pyodide. Revisa la consola.';
      console.error('Error loadPyodide:', err);
      return;
    }

    // Reutilizamos la misma estrategia para capturar stdout
    async function runAndCapture(codeText) {
      const py = [
        "import sys, io",
        "buf = io.StringIO()",
        "old_stdout = sys.stdout",
        "sys.stdout = buf",
        "try:"
      ].join("\n") + "\n";

      const indented = codeText.split("\n").map(line => "    " + line).join("\n");
      const tail = "\nfinally:\n    sys.stdout = old_stdout\nprint(buf.getvalue(), end='')";
      const fullPy = py + indented + tail;

      try {
        // Ejecutar el código y obtener la salida
        await window.pyodide.runPythonAsync(fullPy);
        const out = await window.pyodide.runPythonAsync("buf.getvalue()");
        return out;
      } catch (err) {
        return 'Error de ejecución: ' + err;
      }
    }

    document.getElementById('run').addEventListener('click', async () => {
      runBtn.disabled = true;
      statusEl.textContent = 'Ejecutando...';
      outEl.textContent = '';
      try {
        const code = document.getElementById('python-code').value;
        const result = await runAndCapture(code);
        outEl.textContent = result ?? '';
      } catch (e) {
        outEl.textContent = 'Error inesperado: ' + e;
      } finally {
        runBtn.disabled = false;
        statusEl.textContent = 'Listo.';
      }
    });

    document.getElementById('clear').addEventListener('click', () => {
      outEl.textContent = '';
    });
  })();
  </script>
</body>
</html>
