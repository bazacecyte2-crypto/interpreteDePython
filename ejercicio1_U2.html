<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ejercicio 1_U2 - Promedio (Python)</title>

<script type="module">
import { loadPyodide } from "https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js";

let pyodide;

async function iniciar() {
    pyodide = await loadPyodide();
    document.getElementById("status").textContent = "Pyodide cargado ‚úî";
}
iniciar();

window.validarPython = async function validarPython() {
    const codigoAlumno = document.getElementById("codigoAlumno").value;

    // Colocamos el c√≥digo del alumno en una variable dentro de Python
    pyodide.globals.set("codigo_alumno", codigoAlumno);

    // SCRIPT PYTHON QUE HACE TODA LA VALIDACI√ìN
    const evaluador = `
import sys, math

# Creamos un entorno aislado para el alumno
entorno = {}

try:
    exec(codigo_alumno, entorno)
except Exception as e:
    resultado = "‚ùå Error de sintaxis en tu c√≥digo:\\n" + str(e)
    resultado
    `;

    try:
        const r1 = await pyodide.runPythonAsync(evaluador);
        if (r1) {
            document.getElementById("salida").textContent = r1;
            return;
        }
    } catch (e) {
        document.getElementById("salida").textContent = "‚ùå Error inesperado:\n" + e;
        return;
    }

    // VALIDAR QUE LA FUNCI√ìN exista
    const validar_firma = `
if "promedio" not in entorno:
    resultado = "‚ùå Debes definir la funci√≥n promedio(a, b, c)"
    resultado
`;
    const r2 = await pyodide.runPythonAsync(validar_firma);
    if (r2) {
        document.getElementById("salida").textContent = r2;
        return;
    }

    // LISTA DE TESTS
    const ejecutar_tests = `
salida = ""
tests = [
    ((10,10,10), 10),
    ((6,8,10), 8),
    ((7,7,7), 7),
    ((5,9,6), (5+9+6)/3),
    ((0,10,0), 10/3),
]

func = entorno["promedio"]
todos = True

for idx, (entrada, esperado) in enumerate(tests, start=1):
    try:
        r = func(*entrada)
        r2 = round(r, 2)
        e2 = round(esperado, 2)

        if r2 == e2:
            salida += f"‚úî Test #{idx} correcto {entrada} ‚Üí {r2}\\n"
        else:
            salida += f"‚ùå Test #{idx} incorrecto {entrada} ‚Üí {r2}, esperado {e2}\\n"
            todos = False
    except Exception as e:
        salida += f"‚ùå Test #{idx} fall√≥ por error: {e}\\n"
        todos = False

salida += "\\n--------------------------\\n"
salida += "üéâ ¬°Excelente! Pasaste todos los tests." if todos else "‚ö† Contin√∫a corrigiendo tu funci√≥n."

salida
`;

    const resultadoFinal = await pyodide.runPythonAsync(ejecutar_tests);
    document.getElementById("salida").textContent = resultadoFinal;
};
</script>

</head>
<body>

<h2>Ejercicio 1_U2 ‚Äî Promedio de un alumno (Python)</h2>
<div id="status">Cargando Pyodide...</div>

<p>Escribe una funci√≥n en Python llamada <b>promedio(a, b, c)</b> que regrese el promedio de los 3 valores.</p>

<textarea id="codigoAlumno" style="width:100%; height:200px;">
def promedio(a, b, c):
    # Escribe tu soluci√≥n aqu√≠
    pass
</textarea>

<br><br>
<button onclick="validarPython()">Validar c√≥digo</button>

<h3>Resultado:</h3>
<pre id="salida"></pre>

</body>
</html>

