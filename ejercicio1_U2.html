<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ejercicio 1_U2 — Promedio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 18px; max-width: 900px; }
    textarea { width:100%; height:180px; font-family: monospace; padding:8px; box-sizing:border-box; }
    button { padding:8px 12px; margin-top:8px; }
    #output { background:#111; color:#dcdcdc; padding:10px; min-height:80px; white-space: pre-wrap; margin-top:10px; }
    #status { margin-top:8px; color:#444; }
  </style>
</head>
<body>
  <h1>Ejercicio 1_U2 — Promedio</h1>
  <p>Escribe una función en Python llamada <code>promedio(a, b, c)</code> que regrese el promedio de los 3 valores.</p>

  <label for="python-code">Código (tu solución):</label>
  <textarea id="python-code">def promedio(a, b, c):
    # Escribe tu solución aquí
    return (a + b + c) / 3
</textarea>

  <div>
    <button id="run" disabled>Validar código</button>
    <button onclick="autocorregir()">Autocorregir ejercicio</button>
    <button id="clear">Limpiar salida</button>
    <span id="status">Cargando Pyodide...</span>
  </div>

  <h3>Resultado</h3>
  <pre id="output"></pre>

  <!-- Pyodide clásico (el que sí te funciona) -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

  <script>
  (async () => {
    const statusEl = document.getElementById('status');
    const runBtn = document.getElementById('run');
    const outEl = document.getElementById('output');

    try {
      window.pyodide = await loadPyodide();
      statusEl.textContent = 'Pyodide cargado. Listo.';
      runBtn.disabled = false;
    } catch (err) {
      statusEl.textContent = 'Error cargando Pyodide.';
      console.error(err);
      return;
    }

    // Función que ejecuta código y captura stdout
    async function runAndCapture(pyCode) {

      // Inyectamos los tests estrictos
      const tests = `
def __run_tests():
    try:
        assert promedio(3, 3, 3) == 3
        assert promedio(5, 5, 5) == 5
        assert promedio(2, 4, 6) == 4
        return "✔ Todos los tests aprobados"
    except AssertionError:
        return "❌ Error: los resultados no son correctos"
`;

      const finalCode = pyCode + "\n\n" + tests + "\n__run_tests()";

      try {
        const result = await window.pyodide.runPythonAsync(finalCode);
        return result;
      } catch (err) {
        return "❌ Error de ejecución: " + err;
      }
    }

    document.getElementById('run').addEventListener('click', async () => {
      runBtn.disabled = true;
      outEl.textContent = "";
      statusEl.textContent = "Ejecutando...";

      const code = document.getElementById('python-code').value;
      const result = await runAndCapture(code);

      outEl.textContent = result;
      statusEl.textContent = "Listo.";
      runBtn.disabled = false;
    });

    document.getElementById('clear').addEventListener('click', () => {
      outEl.textContent = '';
    });
  })();
  </script>

</body>
</html>
